# 🚀 社区功能快速开始指南

## ✅ 已完成的开发工作

### 1. 云函数（5个）
- ✅ `publishPost` - 发布帖子
- ✅ `getPosts` - 获取帖子列表（支持分类、分页）
- ✅ `getPostDetail` - 获取帖子详情
- ✅ `postComments` - 评论功能（获取评论、发表评论）
- ✅ `postInteraction` - 互动功能（点赞、收藏）

### 2. 前端页面（3个）
- ✅ `pages/community/index.vue` - 社区首页（已连接云函数）
- ✅ `pages/community/publish.vue` - 发布帖子页面
- ✅ `pages/community/detail.vue` - 帖子详情页面

### 3. 核心功能
- ✅ 用户发布图文帖子（支持最多9张图片）
- ✅ 浏览帖子列表（支持分类筛选）
- ✅ 分页加载（上拉加载更多）
- ✅ 点赞/取消点赞
- ✅ 收藏/取消收藏
- ✅ 发表评论（支持回复）
- ✅ 查看帖子详情
- ✅ 图片预览

---

## 📋 部署步骤（10分钟完成）

### Step 1: 创建数据库表（2分钟）

登录 **uniCloud 控制台**，创建以下数据库表：

#### 表1：community_posts
```json
{
  "_id": "自动生成",
  "userId": "string",
  "username": "string",
  "userAvatar": "string",
  "title": "string",
  "content": "string",
  "category": "string",
  "images": ["array"],
  "likes": "number",
  "comments": "number",
  "shares": "number",
  "collects": "number",
  "views": "number",
  "isPublic": "boolean",
  "status": "string",
  "createdAt": "date",
  "updatedAt": "date"
}
```

**索引设置**：
- `userId_1` - 普通索引
- `category_1` - 普通索引
- `createdAt_-1` - 倒序索引

#### 表2：community_comments
```json
{
  "_id": "自动生成",
  "postId": "string",
  "userId": "string",
  "username": "string",
  "userAvatar": "string",
  "content": "string",
  "replyTo": "string",
  "replyToUser": "string",
  "likes": "number",
  "createdAt": "date"
}
```

**索引设置**：
- `postId_1` - 普通索引
- `userId_1` - 普通索引

#### 表3：community_likes
```json
{
  "_id": "自动生成",
  "postId": "string",
  "userId": "string",
  "createdAt": "date"
}
```

**索引设置**：
- `postId_1_userId_1` - 联合唯一索引（防止重复点赞）

#### 表4：community_collects
```json
{
  "_id": "自动生成",
  "postId": "string",
  "userId": "string",
  "createdAt": "date"
}
```

**索引设置**：
- `postId_1_userId_1` - 联合唯一索引（防止重复收藏）
- `userId_1` - 普通索引（查询用户收藏列表）

---

### Step 2: 上传云函数（3分钟）

在 HBuilderX 中，依次右键上传以下云函数：

```
1. uniCloud-aliyun/cloudfunctions/publishPost
   → 右键 → 上传并部署

2. uniCloud-aliyun/cloudfunctions/getPosts
   → 右键 → 上传并部署

3. uniCloud-aliyun/cloudfunctions/getPostDetail
   → 右键 → 上传并部署

4. uniCloud-aliyun/cloudfunctions/postComments
   → 右键 → 上传并部署

5. uniCloud-aliyun/cloudfunctions/postInteraction
   → 右键 → 上传并部署
```

**验证上传成功**：
- 在 uniCloud 控制台 → 云函数/云对象
- 查看上述5个云函数是否都显示"运行中"

---

### Step 3: 配置pages.json（1分钟）

在 `pages.json` 中添加社区相关页面：

```json
{
  "pages": [
    {
      "path": "pages/community/index",
      "style": {
        "navigationBarTitleText": "健康社区",
        "enablePullDownRefresh": true
      }
    },
    {
      "path": "pages/community/publish",
      "style": {
        "navigationBarTitleText": "发布帖子",
        "navigationStyle": "custom"
      }
    },
    {
      "path": "pages/community/detail",
      "style": {
        "navigationBarTitleText": "帖子详情",
        "navigationStyle": "custom"
      }
    }
  ]
}
```

---

### Step 4: 测试功能（4分钟）

#### 4.1 测试发布帖子
1. 编译运行小程序
2. 进入社区页面
3. 点击右上角 ✏️ 发布按钮
4. 填写标题、内容
5. 选择分类
6. 上传图片（可选）
7. 点击"发布"

**预期结果**：
- ✅ 显示"发布成功"
- ✅ 自动返回社区首页
- ✅ 能看到刚发布的帖子

#### 4.2 测试浏览帖子
1. 在社区首页
2. 切换不同分类
3. 滚动到底部（测试加载更多）

**预期结果**：
- ✅ 能正常切换分类
- ✅ 能加载更多帖子
- ✅ 显示"没有更多帖子了"

#### 4.3 测试点赞收藏
1. 点击帖子的点赞按钮
2. 点击收藏按钮

**预期结果**：
- ✅ 点赞图标变红色 ❤️
- ✅ 数量+1
- ✅ 再次点击取消
- ✅ 收藏同理

#### 4.4 测试评论功能
1. 点击帖子进入详情页
2. 底部输入框输入评论
3. 点击"发送"

**预期结果**：
- ✅ 显示"评论成功"
- ✅ 评论出现在列表中
- ✅ 帖子评论数+1

---

## 🎯 功能清单

### 已实现 ✅
- [x] 发布帖子（图文）
- [x] 浏览帖子列表
- [x] 分类筛选
- [x] 分页加载
- [x] 点赞/取消点赞
- [x] 收藏/取消收藏
- [x] 查看详情
- [x] 发表评论
- [x] 回复评论
- [x] 图片上传到云存储
- [x] 图片预览
- [x] 登录检查

### 可选增强 🚧
- [ ] 删除自己的帖子
- [ ] 编辑帖子
- [ ] 搜索功能
- [ ] 举报功能
- [ ] 用户主页
- [ ] 关注功能
- [ ] 消息通知
- [ ] 热门帖子推荐
- [ ] 帖子分享到微信

---

## 🔧 常见问题

### Q1: 上传图片失败？
**原因**：云存储未开通  
**解决**：
1. uniCloud控制台 → 云存储
2. 开通云存储服务
3. 确认有足够的存储空间

### Q2: 发布帖子后看不到？
**原因**：数据库权限问题  
**解决**：
1. 检查数据库表是否创建成功
2. 检查云函数是否上传成功
3. 查看控制台日志

### Q3: 点赞后刷新页面状态丢失？
**说明**：这是正常的，因为状态保存在内存中  
**解决**：点赞状态已保存到数据库，刷新后会重新获取

### Q4: 评论后看不到自己的评论？
**检查**：
1. 查看云函数日志
2. 确认评论是否插入成功
3. 刷新页面重新加载

### Q5: 图片加载很慢？
**优化**：
1. 上传前压缩图片
2. 使用云存储CDN加速
3. 限制单张图片大小（建议<2MB）

---

## 📱 使用流程

### 用户发帖流程
```
1. 登录账号
   ↓
2. 进入社区首页
   ↓
3. 点击发布按钮 ✏️
   ↓
4. 输入标题和内容
   ↓
5. 选择分类
   ↓
6. 上传图片（可选）
   ↓
7. 点击发布
   ↓
8. 返回首页查看
```

### 用户互动流程
```
1. 浏览帖子列表
   ↓
2. 点赞感兴趣的帖子 ❤️
   ↓
3. 收藏优质内容 ⭐
   ↓
4. 点击帖子查看详情
   ↓
5. 阅读完整内容
   ↓
6. 发表评论 💬
   ↓
7. 回复其他用户
```

---

## 📊 数据统计（可选）

如果需要添加数据统计功能，可以记录：

### 帖子维度
- 浏览量（已实现）
- 点赞数（已实现）
- 评论数（已实现）
- 收藏数（已实现）
- 分享次数

### 用户维度
- 发帖数量
- 获赞总数
- 评论总数
- 粉丝数量

### 分类统计
- 各分类帖子数量
- 最热门分类
- 最活跃分类

---

## 🎨 界面预览

### 社区首页
```
┌────────────────────────────────┐
│  健康社区              🔍  ✏️   │
├────────────────────────────────┤
│ [全部][疾病][治疗][用药]...    │
├────────────────────────────────┤
│ 👤 用户名    2小时前    [分类] │
│ 【标题】                        │
│ 内容摘要...                    │
│ [图片] [图片] [图片]           │
│ 🤍 156  💬 23  📤 12  ☆ 45    │
├────────────────────────────────┤
│ ...更多帖子...                 │
└────────────────────────────────┘
```

### 发布页面
```
┌────────────────────────────────┐
│ ←  发布帖子              [发布] │
├────────────────────────────────┤
│ 请输入标题（必填）              │
│                                │
│ 分享你的经验和心得...           │
│                                │
│ [📷] [📷] [📷] [+添加图片]     │
│                                │
│ 选择分类：                      │
│ [疾病交流][治疗经验][用药咨询] │
└────────────────────────────────┘
```

### 详情页面
```
┌────────────────────────────────┐
│ ←  帖子详情                     │
├────────────────────────────────┤
│ 👤 用户名    2小时前            │
│ 【完整标题】                    │
│ 完整内容...                    │
│ [图片展示]                      │
│ 156浏览 23点赞 12评论 45收藏   │
│ [🤍点赞] [☆收藏] [📤分享]      │
├────────────────────────────────┤
│ 全部评论 (23)                  │
│ 👤 评论者：评论内容             │
│    回复 · 刚刚                 │
└────────────────────────────────┘
│ [说说你的看法...] [发送]       │
└────────────────────────────────┘
```

---

## ✨ 完成！

现在你的健康社区功能已经完全可用了！

**核心功能**：
- ✅ 用户可以发布帖子
- ✅ 可以浏览别人的帖子
- ✅ 可以点赞、收藏
- ✅ 可以发表评论和回复

**下一步建议**：
1. 测试所有功能
2. 邀请用户试用
3. 收集反馈
4. 持续优化

---

**开发完成时间**：2025-10-25  
**版本**：v1.0  
**开发者文档**：详见 COMMUNITY_DEVELOPMENT.md

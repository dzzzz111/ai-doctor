# 🎨 批量生成视频封面指南

## 📌 功能说明

为数据库中**已有的视频**批量生成专业封面图，不需要重新初始化数据。

---

## 🚀 操作步骤（3步完成）

### 第1步：上传云函数

```
右键 uniCloud-aliyun/cloudfunctions/initRehabVideos
→ 上传并部署
```

### 第2步：访问视频管理后台

```
小程序或浏览器访问：/pages/admin/init-videos
```

### 第3步：点击"批量生成封面"

1. 在视频列表区域
2. 点击绿色的**"批量生成封面"**按钮
3. 确认操作
4. 等待生成完成

---

## 🎯 生成规则

### 自动匹配封面

系统根据视频的 `category` 字段自动分配封面：

#### 💪 **力量训练 (strength)**
- 封面1: 力量训练动作
- 封面2: 深蹲训练
- 封面3: 腿部训练

#### 🧘 **柔韧性训练 (flexibility)**
- 封面1: 拉伸训练
- 封面2: 瑜伽拉伸
- 封面3: 柔韧性动作

#### ⚖️ **平衡训练 (balance)**
- 封面1: 平衡训练
- 封面2: 稳定性训练

### 智能循环分配

- 同类型的视频会循环使用封面
- 例如：第1个力量视频用封面1，第2个用封面2，第4个又用封面1

### 保护已有封面

- ✅ **只为没有封面的视频生成**
- ✅ **已有封面的视频不受影响**
- ✅ **可以多次运行，安全无损**

---

## 📊 视频列表显示

### 封面状态标识

```
视频标题
┌──────────────────────────────┐
│ [✓ 有封面] 或 [⚠ 无封面]     │
└──────────────────────────────┘
```

- 🟢 **绿色** "✓ 有封面" - 视频已配置封面
- 🔴 **红色** "⚠ 无封面" - 视频需要生成封面

### 查看详情

每个视频显示：
- 视频标题
- 时长、难度、训练类别
- 适用分期
- 视频链接（前50字符）
- 封面链接（前50字符）

---

## 🔍 封面来源

所有封面图片来自 **Unsplash**（免费高质量图库）：
- ✅ 专业健身摄影
- ✅ 完全免费可商用
- ✅ 高清晰度（640x360）
- ✅ 符合医疗康复风格

---

## 💡 使用场景

### 场景1：首次添加视频后
```
1. 通过后台添加了多个视频
2. 但都没有设置封面
3. 点击"批量生成封面"一键解决
```

### 场景2：补充封面
```
1. 有些视频有封面，有些没有
2. 只想为缺失封面的视频生成
3. 点击"批量生成封面"，已有封面不变
```

### 场景3：定期检查
```
1. 定期访问视频管理后台
2. 查看是否有"⚠ 无封面"的视频
3. 点击"批量生成封面"补充
```

---

## ⚙️ 技术实现

### 云函数逻辑
```javascript
// 核心代码
for (const video of videos) {
  // 跳过已有封面的视频
  if (video.thumbnailUrl && video.thumbnailUrl.trim() !== '') {
    continue;
  }
  
  // 根据类别和索引生成封面URL
  const category = video.category || 'strength';
  const coverUrl = getCoverUrl(category, index);
  
  // 更新数据库
  await videosCollection.doc(video._id).update({
    thumbnailUrl: coverUrl
  });
}
```

### 封面URL格式
```
https://images.unsplash.com/photo-XXXXX?w=640&h=360&fit=crop
```

参数说明：
- `w=640` - 宽度640px
- `h=360` - 高度360px（16:9比例）
- `fit=crop` - 裁剪填充

---

## 🔧 常见问题

### Q1：会覆盖我已有的封面吗？

**不会！** 功能只为 `thumbnailUrl` 为空的视频生成封面。

### Q2：可以重复运行吗？

**可以！** 每次运行只处理没有封面的视频，非常安全。

### Q3：生成后不喜欢怎么办？

**两种方法修改：**

1. **手动替换**：
   ```
   uniCloud控制台 → 云数据库 → rehabilitation_videos
   → 编辑记录 → 修改 thumbnailUrl
   ```

2. **清空重新生成**：
   ```
   在数据库中将 thumbnailUrl 设为空
   → 再次点击"批量生成封面"
   ```

### Q4：封面图加载慢怎么办？

**优化方案：**
1. Unsplash 在国内访问可能较慢
2. 建议下载图片后上传到云存储
3. 修改数据库中的 thumbnailUrl 为云存储路径

### Q5：如何使用自己的封面图？

**方法1：批量替换**
```sql
-- 在云函数中执行脚本
const coverUrl = 'cloud://your-env.xxx/covers/strength-1.jpg';
await db.collection('rehabilitation_videos')
  .where({ category: 'strength' })
  .update({ thumbnailUrl: coverUrl });
```

**方法2：逐个修改**
```
数据库中逐个编辑 thumbnailUrl 字段
```

---

## 📈 生成结果示例

### 成功提示
```
┌─────────────────────────────┐
│  生成成功                   │
│                             │
│  共 15 个视频               │
│  已为 12 个视频生成封面     │
│                             │
│  [确定]                     │
└─────────────────────────────┘
```

### 视频列表效果
```
[封面图] 股四头肌训练 - I期  [✓ 有封面]
[封面图] 直腿抬高 - I期      [✓ 有封面]
[占位图] 新视频              [⚠ 无封面]
```

---

## 🎯 最佳实践

1. **先生成，后调整**
   - 先批量生成所有封面
   - 再根据需要逐个调整

2. **定期检查**
   - 添加新视频后记得生成封面
   - 访问管理后台查看封面状态

3. **统一风格**
   - 建议所有同类视频使用统一风格封面
   - 提升用户体验

4. **优先云存储**
   - 长期使用建议上传到云存储
   - 避免外部链接失效

---

## 📝 总结

### 核心功能
✅ 为现有视频批量生成封面  
✅ 自动根据训练类型匹配  
✅ 保护已有封面不被覆盖  
✅ 可视化显示封面状态  
✅ 一键操作，简单快捷  

### 使用流程
```
上传云函数 → 访问管理后台 → 点击按钮 → 完成
```

### 效果展示
- 🎨 所有视频都有专业封面
- 📊 封面与训练类型匹配
- 👀 视觉效果显著提升
- ⚡ 用户体验更好

---

**文档更新时间**：2025-10-24  
**版本**：v1.0
